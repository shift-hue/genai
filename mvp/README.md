# AI-Based Financial Transaction Categorization MVP

This project is an end-to-end MVP for automated categorization of financial transactions using local, open-source models.

It includes:
- Synthetic dataset generation
- Embedding-based classifier (MiniLM/SBERT + k-NN)
- FastAPI backend with REST endpoints
- Minimal frontend UI for single and batch predictions
- Explainability (nearest neighbors, keyword matches, rationale)
- Feedback loop for corrections
- Evaluation pipeline and documentation

## Architecture Summary

- **Preprocessing**: text normalization (`normalize_text`, `normalize_batch`) removes noise such as casing, punctuation, and trailing digits.
- **Embeddings**: SBERT MiniLM (`sentence-transformers/all-MiniLM-L6-v2`) converts normalized descriptions into dense vectors.
- **Classifier**: k-NN classifier (cosine distance) trained on synthetic data predicts a category ID.
- **Thresholding**: low-confidence predictions are mapped to an `UNKNOWN` category using a configurable threshold.
- **Explainability**: top-3 nearest neighbors with cosine similarity and token frequency-based keyword matches, plus a short rationale.
- **Feedback Loop**: user corrections are appended to `data/corrections.json` for future retraining or index updates.
- **API Layer**: FastAPI app (`mvp.src.api:app`) exposes REST endpoints for single and batch inference, taxonomy upload, corrections, and evaluation artifact access.
- **UI**: Static HTML/JS/CSS in `mvp/ui` interacts with the API for predictions, CSV upload, taxonomy admin, and corrections.

## Dataset

- Synthetic dataset is generated by `mvp/src/generate_synthetic_dataset.py`.
- At least 600 transaction samples across 10+ categories are written to CSV files in `mvp/data/generated/` (`train.csv`, `val.csv`, `test.csv`).
- Noise includes misspellings, abbreviations, and optional trailing digits.
- Fields: `description`, `amount`, `merchant`, `category_id`.

## Running the System

1. **Install dependencies** (ideally in a virtual environment):
   ```bash
   pip install -r requirements.txt
   ```
2. **Generate dataset** (if not already generated):
   ```bash
   python -m mvp.src.generate_synthetic_dataset
   ```
3. **Run the API server**:
   ```bash
   uvicorn mvp.src.api:app --reload
   ```
4. **Open the UI**:
   - Visit `http://localhost:8000/ui/index.html` in your browser.

## Evaluation

- Run the evaluation script to compute metrics and confusion matrix:
  ```bash
  python -m mvp.evaluation.evaluate
  ```
- Outputs (in `mvp/evaluation/`):
  - `confusion_matrix.png`
  - `per_class_metrics.json`
  - `macro_f1_score.json`
  - `performance_notes.md`

## Reproducibility

- Deterministic behavior is controlled via `random_seed` in `mvp/config/settings.json`.
- Taxonomy, aliases, and thresholds are all stored in versioned JSON files under `mvp/config/`.
- Synthetic dataset generation, training, and evaluation can be repeated using the commands above.

## Model Explanation

- The classifier uses dense SBERT embeddings and k-NN with cosine distance.
- Explainability surfaces:
  - Top-3 nearest neighbors with similarity scores.
  - Keyword/token frequency matches from the normalized description.
  - A textual rationale summarizing why the predicted category was chosen.

## Bias and Ethical Considerations

- The dataset is synthetic and does not contain real user data; however, care should still be taken when extending the system to production.
- Category design and alias lists may implicitly encode assumptions about spending behavior; review taxonomy choices for fairness.
- When trained on real data, ensure compliance with privacy regulations and avoid using sensitive attributes in the model.
- Provide clear user-facing messaging that predictions are assistive and may require human review in critical financial workflows.
